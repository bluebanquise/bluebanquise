---
- name: package <|> Install clustershell system package
  ansible.builtin.package:
    name: clustershell
    state: present
  when: clustershell_install_from_package
  tags:
    - package

- name: package <|> Install clustershell pip package
  ansible.builtin.pip:
    name: clustershell
    state: present
  when: clustershell_install_from_pip
  tags:
    - pip

- name: file <|> Create configuration directory
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: 0755
  loop:
    - /etc/clustershell
    - /etc/clustershell/groups.d

- name: template <|> Generate /etc/clustershell/groups.d/local.cfg
  ansible.builtin.template:
    src: local.cfg.j2
    dest: /etc/clustershell/groups.d/local.cfg
    owner: root
    group: root
    mode: 0644
  tags:
    - template
  when: clustershell_custom_map == false

- name: cluster <|> Create clusters.yaml if clush inventory exists
  ansible.builtin.template:
    src: cluster.yaml.j2
    dest: /etc/clustershell/groups.d/cluster.yaml
    owner: root
    group: root
    mode: 0644
  tags:
    - template
  when: clush is defined and clustershell_custom_map

- name: cluster <|> Create local.cfg with mapping names
  ansible.builtin.template:
    src: local.cfg.mapping.j2
    dest: /etc/clustershell/groups.d/local.cfg
    owner: root
    group: root
    mode: 0644
  tags:
    - template
  when: clush is defined and clustershell_custom_map
