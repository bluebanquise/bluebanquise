#### Blue Banquise file ####
## {{ansible_managed}}

{% if ansible_facts.distribution in ['RedHat', 'CentOS'] and
      ansible_facts.distribution_major_version|int < 8 %}
SERVER execpath="/usr/share/conman/exec"
{% else %}
SERVER execpath="/usr/lib/conman/exec"
{% endif %}
SERVER syslog="daemon"
SERVER logdir="/var/log/conman"
GLOBAL log="/var/log/conman/%N.log"
SERVER timestamp=1h
GLOBAL logopts="timestamp"

{% for host in groups[j2_current_iceberg] %}
{% if hostvars[host]['equipment_profile']['equipment_type'] == "server" %}
console name="{{host}}" dev="ipmitool.exp {{hostvars[host]['bmc']['ip4']}} {{hostvars[host]['equipment_profile']['authentication']['equipment_user']}} {{hostvars[host]['equipment_profile']['authentication']['equipment_password']}}"
{% endif %}
{% endfor %}

{% for under_icb in j2_under_icebergs %}
{% for host in groups[managements_group_name] %}
{% if (groups[under_icb] is defined and not none) and (host in groups[under_icb]) %}
{% if hostvars[host]['equipment_profile']['equipment_type'] == "server" %}
console name="{{host}}" dev="ipmitool.exp {{hostvars[host]['bmc']['ip4']}} {{hostvars[host]['equipment_profile']['authentication']['equipment_user']}} {{hostvars[host]['equipment_profile']['authentication']['equipment_password']}}"
{% endif %}
{% endif %}
{% endfor %}
{% endfor %}

