---
- name: Verify
  hosts: all

  tasks:
  - name: check all files have been generated
    find:
      paths: /etc/sysconfig/network-scripts
      patterns: "ifcfg-eth*"
    register: ifcfg_list

  - name: assert we have 3 eth files
    assert:
      that: ifcfg_list.matched == 3

  - name: cat /etc/sysconfig/network-scripts/ifcfg-XX files
    command: cat /etc/sysconfig/network-scripts/ifcfg-eth0
    changed_when: false
    register: cat_out
    with_items:
      - eth0
      - eth1
      - eth2

  - name: debug
    debug:
      var: cat_out

  - name: assert eth0 and eth1
    lineinfile:
      path: "/etc/sysconfig/network-scripts/ifcfg-{{ item }}"
      line: "IPADDR={{ hostvars[inventory_hostname]['ansible_' + item].ipv4.address }}"
      state: present
    register: presence
    failed_when: presence is changed
    with_items:
      - eth0
      - eth1

  - name: assert eth2
    lineinfile:
      path: /etc/sysconfig/network-scripts/ifcfg-eth2
      line: "{{ item }}"
      state: present
    register: presence
    failed_when: presence is changed
    with_items:
      - IPADDR="{{ hostvars[inventory_hostname]['ansible_eth0'].ipv4.address }}"
      - NETMASK="{{ hostvars[inventory_hostname]['ansible_eth0'].ipv4.netmask }}"
