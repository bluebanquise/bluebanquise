{# Macro to avoid redundancy #}
{% macro write_host(host) %}
Host {{host}}
    StrictHostKeyChecking no
    UserKnownHostsFile=/dev/null
    Hostname %h-{{hostvars[host]['j2_node_main_network']}}
{% endmacro %}

#### Blue Banquise file ####
## {{ansible_managed}}

# All or Iceberg hosts

{% if icebergs_system == 'true' and hosts_file['range'] == 'iceberg' %}
{% set range = (current_iceberg|string) %}
{% else %}
{% set range = 'all' %}
{% endif %}

{% for host in groups[range] %}
{{write_host(host)}}
{% endfor %}

# Under iceberg {{managements_group_name}}

{% for under_icb in j2_under_icebergs %}
{% for host in groups[managements_group_name] %}
{% if (groups[under_icb] is defined and not none) and (host in groups[under_icb]) %}
{{write_host(host)}}
{% endif %}
{% endfor %}
{% endfor %}

