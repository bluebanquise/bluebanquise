{# Macro to avoid redundancy #}
{% macro write_host(host) %}
Host {{host}}
    StrictHostKeyChecking no
    UserKnownHostsFile=/dev/null
    Hostname %h-{{hostvars[host]['node_main_network']}}
{% endmacro %}

#### Blue Banquise file ####
## {{ansible_managed}}

# Iceberg hosts

{% for host in groups[(current_iceberg|string)] %}
{{write_host(host)}}
{% endfor %}

# Under iceberg {{managements_group_name}}

{% for under_icb in under_icebergs %}
{% for host in groups[managements_group_name] %}
{% if (groups[under_icb] is defined and not none) and (host in groups[under_icb]) %}
{{write_host(host)}}
{% endif %}
{% endfor %}
{% endfor %}

