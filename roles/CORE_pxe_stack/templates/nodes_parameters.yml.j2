#### Blue Banquise file ####
## {{ansible_managed}}

{% if icebergs_system == 'true' and hosts_file['range'] == 'iceberg' %}
{% set range = (current_iceberg|string) %}
{% else %}
{% set range = 'all' %}
{% endif %}

{% for host in groups[range] %}
{{host}}:
  equipment_profile: "{{ hostvars[host]['group_names'] | select('match','^'+equipment_naming+'_.*') | list | unique | sort | first | join | replace('equipment_','') | trim }}"
{% endfor %}

{% for under_icb in j2_under_icebergs %}
{% for host in groups[managements_group_name] %}
{% if (groups[under_icb] is defined and not none) and (host in groups[under_icb]) %}
{{host}}:
  equipment_profile: "{{ hostvars[host]['group_names'] | select('match','^'+equipment_naming+'_.*') | list | unique | sort | first | join | replace('equipment_','') | trim }}"
{% endif %}
{% endfor %}
{% endfor %}

